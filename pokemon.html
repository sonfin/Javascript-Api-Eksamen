<!DOCTYPE html>
<html lang="nb">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="pokemon.css" />
    <title>Pokemon | Eksamen</title>
  </head>
  <body>
    <header>
      <nav>
        <!-- http://www.rw-designer.com/cursor-detail/55503 -->
        <button type="button" id="sort-nav-btn">Sorter:</button>
        <h1>Pokemon finner app</h1>
        <button type="button" id="favorites-nav-btn">Favoritter</button>
      </nav>
    </header>
    <main>
      <div class="container-1">
        <div class="sorting-grid"></div>
      </div>
      <div class="container-2">
        <div class="card-grid"></div>
      </div>
      <div class="container-3"></div>
    </main>
    <script>
      const sortNavBtn = document.querySelector("#sort-nav-btn");
      const favoritesNavBtn = document.querySelector("#favorites-nav-btn");
      const sortingGrid = document.querySelector(".sorting-grid");
      const cardGrid = document.querySelector(".card-grid");

      const emoji = ["ü§ç", "üíñ", "‚ùå", "‚ôª", "‚úç", "‚úè", "‚úé"];
      let allPokemonArray = [];
      const uniqueNumersArray = [];
      const unique50Pokemon = [];
      const pokeApiUrlArray = [];
      const pokeInfo = [];
      const typeArray = [
        "bug",
        "dark",
        "dragon",
        "electric",
        "fairy",
        "fighting",
        "fire",
        "flying",
        "ghost",
        "grass",
        "ground",
        "ice",
        "normal",
        "poison",
        "psychic",
        "rock",
        "steel",
        "water",
        "custom",
      ];
      // Fetch api's

      sortNavBtn.onclick = displaySortGrid;
      initializeAllPokemon();

      async function getAllPokemons() {
        const pokemonRequest = await fetch(
          "https://pokeapi.co/api/v2/pokemon?limit=100000&offset=0"
        );
        const pokemonResult = await pokemonRequest.json();
        return pokemonResult.results;
      }

      async function initializeAllPokemon() {
        try {
          allPokemonArray = await getAllPokemons();
          uniquePokemon = await uniquePokemon50();
        } catch (error) {
          console.error("Error med √• laste innhold", error);
        }
      }

      // Random 50 pokemons

      async function uniquePokemon50() {
        try {
          while (uniqueNumersArray.length < 50) {
            const randomNumber = Math.floor(
              Math.random() * allPokemonArray.length
            );
            if (!uniqueNumersArray.includes(randomNumber)) {
              uniqueNumersArray.push(randomNumber);
            }
          }
          getPokemonInfo();
        } catch (error) {
          console.error("Error med √• generere unique pokemon", error);
        }
      }

      async function getPokemonInfo() {
        uniqueNumersArray.forEach((number) => {
          const pokemon = allPokemonArray[number];
          pokeApiUrlArray.push(pokemon.url);
        });

        try {
          for (const url of pokeApiUrlArray) {
            const response = await fetch(url);
            const pokeInfo = await response.json();
            unique50Pokemon.push(pokeInfo);
          }
          displayPokemonCards();
          typeSorter();
        } catch (error) {
          console.error("Error med √• hente pokemon api:", error);
        }
      }

      function displaySortGrid() {
        while (sortingGrid.firstChild) {
          sortingGrid.removeChild(sortingGrid.firstChild);
        }
        for (let i = 0; i < typeArray.length; i++) {
          const type = typeArray[i];
          const typeImage = document.createElement("div");
          sortingGrid.appendChild(typeImage);
          typeImage.innerHTML = `<img src="./assets/${type}-48px.png" alt="${type} type" />`;
          typeImage.id = `type-${type}`;
          typeImage.addEventListener("click", () => sortByType(type, i));
        }
      }
      // Funksjonen kan forkortes.
      function displayPokemonCards(type) {
        let cards = "";
        for (let i = 0; i < unique50Pokemon.length; i++) {
          const card = unique50Pokemon[i];

          const pokemonCard = document.createElement("div");
          cardGrid.appendChild(pokemonCard);
          pokemonCard.className = "card";

          const cardId = document.createElement("p");
          pokemonCard.appendChild(cardId);
          cardId.textContent = `#${card.id}`;
          // Det hender at det ikke eksisterer bilde, se om man kan errorh√•ndtere det.
          const cardImage = document.createElement("div");
          pokemonCard.appendChild(cardImage);
          cardImage.innerHTML = `<img src="${card.sprites.front_default}" alt="${card.name}(en Pokemon)" />`;

          const cardName = document.createElement("h2");
          pokemonCard.appendChild(cardName);
          cardName.textContent = `${card.name}`;

          const cardType = document.createElement("p");
          pokemonCard.appendChild(cardType);
          cardType.textContent = `Type: ${card.types[0].type.name}`;

          const cardDiv = document.createElement("div");
          pokemonCard.appendChild(cardDiv);

          const cardLike = document.createElement("h1");
          cardDiv.appendChild(cardLike);
          cardLike.textContent = "ü§ç";
          cardLike.addEventListener("click", () => addToLike());

          const cardEdit = document.createElement("h1");
          cardDiv.appendChild(cardEdit);
          cardEdit.textContent = "‚úé";
          cardEdit.addEventListener("click", () => editCard());

          const cardDelete = document.createElement("h1");
          cardDiv.appendChild(cardDelete);
          cardDelete.textContent = "‚ùå";
          cardDelete.addEventListener("click", () => deleteCard());
        }
      }
      const sortArrays = [];
      const sortTypeArrays = [];

      async function typeSorter() {
        typeArray.forEach((type) => {
          const typeApiArray = `https://pokeapi.co/api/v2/type/${type}/`;
          sortArrays.push(typeApiArray);
        });

        try {
          for (let i = 0; i < sortArrays.length - 1; i++) {
            const url = sortArrays[i];
            const response = await fetch(url);
            const typeInfo = await response.json();
            sortTypeArrays.push(typeInfo);
          }

          console.log(sortTypeArrays);
        } catch (error) {
          console.error("Error med √• hente typer:", error);
        }
      }

      function sortByType(type, index) {
        console.log(type, index);
      }
    </script>
  </body>
</html>
